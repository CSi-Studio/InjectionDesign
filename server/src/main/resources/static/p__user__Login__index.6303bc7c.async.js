"use strict";(self.webpackChunkInjection_Design=self.webpackChunkInjection_Design||[]).push([[51],{93191:function(ee,R,r){r.r(R),r.d(R,{default:function(){return oe}});var b=r(15009),g=r.n(b),E=r(97857),d=r.n(E),I=r(99289),j=r.n(I),U=r(5574),M=r.n(U),L=r(88918),w=r(87547),N=r(94149),p=r(19011),u=r(10328),re=r(14670),C=r(12461),z=r(5),W=r(67294),_={container:"container___ozzIF",lang:"lang___gstBI",content:"content___lg4sZ",icon:"icon___hKsIT"},ne=r(78158);function fe(t){return B.apply(this,arguments)}function B(){return B=_asyncToGenerator(_regeneratorRuntime().mark(function t(s){return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",request("/api/currentUser",_objectSpread({method:"GET"},s||{})));case 1:case"end":return e.stop()}},t)})),B.apply(this,arguments)}function he(t){return F.apply(this,arguments)}function F(){return F=_asyncToGenerator(_regeneratorRuntime().mark(function t(s){return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",request("/api/login/outLogin",_objectSpread({method:"POST"},s||{})));case 1:case"end":return e.stop()}},t)})),F.apply(this,arguments)}function te(t){return O.apply(this,arguments)}function O(){return O=j()(g()().mark(function t(s){return g()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("".concat(ne.H,"/login/account"),{method:"POST",headers:{"Content-Type":"application/json"},params:d()({},s)}));case 1:case"end":return e.stop()}},t)})),O.apply(this,arguments)}function ve(t){return x.apply(this,arguments)}function x(){return x=_asyncToGenerator(_regeneratorRuntime().mark(function t(s){return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",request("/api/notices",_objectSpread({method:"GET"},s||{})));case 1:case"end":return e.stop()}},t)})),x.apply(this,arguments)}function ye(t,s){return $.apply(this,arguments)}function $(){return $=_asyncToGenerator(_regeneratorRuntime().mark(function t(s,i){return _regeneratorRuntime().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.abrupt("return",request("/api/rule",_objectSpread({method:"GET",params:_objectSpread({},s)},i||{})));case 1:case"end":return y.stop()}},t)})),$.apply(this,arguments)}function je(t){return G.apply(this,arguments)}function G(){return G=_asyncToGenerator(_regeneratorRuntime().mark(function t(s){return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",request("/api/rule",_objectSpread({method:"PUT"},s||{})));case 1:case"end":return e.stop()}},t)})),G.apply(this,arguments)}function Me(t){return A.apply(this,arguments)}function A(){return A=_asyncToGenerator(_regeneratorRuntime().mark(function t(s){return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",request("/api/rule",_objectSpread({method:"POST"},s||{})));case 1:case"end":return e.stop()}},t)})),A.apply(this,arguments)}function _e(t){return Z.apply(this,arguments)}function Z(){return Z=_asyncToGenerator(_regeneratorRuntime().mark(function t(s){return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",request("/api/rule",_objectSpread({method:"DELETE"},s||{})));case 1:case"end":return e.stop()}},t)})),Z.apply(this,arguments)}var se=r(99188),ae=r(52983),ue=r(11238),n=r(85893),k=function(s){var i=s.content;return(0,n.jsx)(re.Z,{style:{marginBottom:24},message:i,type:"error",showIcon:!0})},ie=function(){var s=(0,W.useState)({}),i=M()(s,2),e=i[0],y=i[1],le=(0,W.useState)("account"),H=M()(le,2),D=H[0],ce=H[1],V=(0,u.useModel)("@@initialState"),S=V.initialState,Q=V.setInitialState,h=(0,u.useIntl)(),Se=function(){var v=j()(g()().mark(function o(){var l,f;return g()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return m.next=2,S==null||(l=S.fetchUserInfo)===null||l===void 0?void 0:l.call(S);case 2:if(f=m.sent,console.log("userInfo",f),!f){m.next=7;break}return m.next=7,Q(function(P){return d()(d()({},P),{},{currentUser:f})});case 7:case"end":return m.stop()}},o)}));return function(){return v.apply(this,arguments)}}(),X=(0,u.useRequest)(se.z,{manual:!0,onSuccess:function(o){o.status==="ok"&&(C.ZP.success("register success\uFF01"),u.history.push({pathname:"/user/login"}))}}),Te=X.loading,ge=X.run,de=function(o){console.log(o),ge(o)},me=function(){var v=j()(g()().mark(function o(l){var f,a,m,P,q;return g()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.prev=0,l.username=(f=l.username)===null||f===void 0?void 0:f.trim(),l.autoLogin=!0,c.next=5,te(d()({},l));case 5:if(a=c.sent,!a.success){c.next=18;break}return console.log(a),ae.Z.save(a.data.id),ue.ZP.interceptors.request.use(function(K,T){var pe={"X-Access-Token":"".concat(a.data.token)};return{url:K,options:d()(d()({},T),{},{interceptors:!0,headers:pe})}}),Q(function(K){var T;return d()(d()({},K),{},{currentUser:{name:(T=a.data)===null||T===void 0?void 0:T.userName}})}),console.log("setInitialState",S),m=h.formatMessage({id:"pages.login.success",defaultMessage:"\u767B\u5F55\u6210\u529F\uFF01\u6B22\u8FCE\u8FDB\u5165\u5B9E\u9A8C\u5BA4\u8FDB\u6837\u7CFB\u7EDF"}),C.ZP.success(m),P=new URL(window.location.href).searchParams,u.history.push(P.get("redirect")||"/"),window.location.reload(),c.abrupt("return");case 18:console.log(a),y({type:"account",status:"error"}),c.next=28;break;case 22:c.prev=22,c.t0=c.catch(0),q=h.formatMessage({id:"pages.login.failure",defaultMessage:"\u767B\u5F55\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5\uFF01"}),console.log(c.t0),y({type:"account",status:"error"}),C.ZP.error(q);case 28:case"end":return c.stop()}},o,null,[[0,22]])}));return function(l){return v.apply(this,arguments)}}(),J=e.status,Y=e.type;return(0,n.jsxs)("div",{className:_.container,children:[(0,n.jsx)("div",{className:_.lang,"data-lang":!0,children:u.SelectLang&&(0,n.jsx)(u.SelectLang,{})}),(0,n.jsx)("div",{className:_.content,children:(0,n.jsxs)(p.U0H,{logo:(0,n.jsx)("img",{alt:"logo",src:"/injection.svg",style:{marginTop:"7px"}}),title:h.formatMessage({id:"pages.layouts.system.title"}),subTitle:h.formatMessage({id:"pages.layouts.userLayout.title"}),initialValues:{autoLogin:!0},submitter:{searchConfig:{submitText:"".concat(D==="account"?"login":"register")},submitButtonProps:{style:{width:"100%"}},resetButtonProps:!1},onFinish:function(){var v=j()(g()().mark(function o(l){return g()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(D!=="register"){a.next=5;break}console.log("register",l),de(l),a.next=7;break;case 5:return a.next=7,me(l);case 7:case"end":return a.stop()}},o)}));return function(o){return v.apply(this,arguments)}}(),children:[(0,n.jsx)(z.Z,{activeKey:D,onChange:ce,centered:!0,children:(0,n.jsx)(z.Z.TabPane,{tab:h.formatMessage({id:"pages.login.accountLogin.tab",defaultMessage:"\u8D26\u6237\u5BC6\u7801\u767B\u5F55"})},"account")}),J==="error"&&Y==="account"&&(0,n.jsx)(k,{content:h.formatMessage({id:"pages.login.accountLogin.errorMessage",defaultMessage:"\u8D26\u6237\u6216\u5BC6\u7801\u9519\u8BEF(admin/admin)"})}),D==="account"&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(p.VaQ,{name:"username",fieldProps:{size:"large",prefix:(0,n.jsx)(w.Z,{className:_.prefixIcon})},placeholder:h.formatMessage({id:"pages.login.username.placeholder",defaultMessage:"\u7528\u6237\u540D: guest"}),rules:[{required:!0,message:(0,n.jsx)(u.FormattedMessage,{id:"pages.login.username.required",defaultMessage:"\u8BF7\u8F93\u5165\u7528\u6237\u540D!"})}]}),(0,n.jsx)(p.VaQ.Password,{name:"password",fieldProps:{size:"large",prefix:(0,n.jsx)(N.Z,{className:_.prefixIcon})},placeholder:h.formatMessage({id:"pages.login.password.placeholder",defaultMessage:"\u5BC6\u7801: guest"}),rules:[{required:!0,message:(0,n.jsx)(u.FormattedMessage,{id:"pages.login.password.required",defaultMessage:"\u8BF7\u8F93\u5165\u5BC6\u7801\uFF01"})}]}),(0,n.jsxs)("div",{style:{marginBottom:24},children:[(0,n.jsx)(p.V2E,{noStyle:!0,name:"autoLogin",children:(0,n.jsx)(u.FormattedMessage,{id:"pages.login.rememberMe",defaultMessage:"\u81EA\u52A8\u767B\u5F55"})}),(0,n.jsx)("a",{onClick:function(){u.history.push("/user/register")},style:{float:"right"},children:(0,n.jsx)(u.FormattedMessage,{id:"pages.login.registerAccount",defaultMessage:"\u5FD8\u8BB0\u5BC6\u7801"})})]})]}),J==="error"&&Y==="register"&&(0,n.jsx)(k,{content:"\u9A8C\u8BC1\u7801\u9519\u8BEF"})]})}),(0,n.jsx)(L.Z,{})]})},oe=ie},99188:function(ee,R,r){r.d(R,{z:function(){return U}});var b=r(15009),g=r.n(b),E=r(99289),d=r.n(E),I=r(10328),j=r(78158);function U(L){return M.apply(this,arguments)}function M(){return M=d()(g()().mark(function L(w){return g()().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.abrupt("return",(0,I.request)("".concat(j.H,"/login/register"),{method:"post",data:w}));case 1:case"end":return p.stop()}},L)})),M.apply(this,arguments)}}}]);
